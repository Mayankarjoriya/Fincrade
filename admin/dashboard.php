<?phprequire_once __DIR__ . '/../includes/auth.php';require_once __DIR__ . '/../includes/user_manager.php';require_once __DIR__ . '/../includes/lead_manager.php';require_once __DIR__ . '/../includes/mail_handler.php';$auth = new Auth();$auth->requireAuth(['super_admin']);$userManager = new UserManager();$leadManager = new LeadManager();//Init mail handler$mailHandler = new MailHandler();$currentUser = $auth->getCurrentUser();////echo $userManager;//echo $leadManager;//echo $currentUser;// Handle user actionsif ($_SERVER['REQUEST_METHOD'] === 'POST') {    $action = $_POST['action'] ?? '';    header('content-type: application/json');    switch ($action) {        case 'create_user':            $result = $userManager->createUser(                $_POST['username'],                $_POST['email'],                $_POST['password'],                $_POST['role'],                $_POST['full_name'],                $_POST['phone'],                $currentUser['id']            );            echo json_encode([                    'success' => $result['success'],                'message' => $result['success'] ? 'user created successfully!'                        : $result['message']            ]);////            $_SESSION['message'] = $result['success'] ? 'User created successfully!' : $result['message'];////            $_SESSION['message_type'] = $result['success'] ? 'success' : 'error';////            header('Location: dashboard.php');//            exit();        case 'update_user':            $result = $userManager->updateUser(                $_POST['user_id'],                $_POST['username'],                $_POST['email'],                $_POST['full_name'],                $_POST['phone'],                $_POST['status']            );            echo json_encode([                    'success' => $result['success'],                    'message' => $result['success'] ? 'User Updated successfully!'                            : $result['message']            ]);//            $_SESSION['message'] = $result['success'] ? 'User updated successfully!' : $result['message'];//    // JSON response bata do//            $_SESSION['message_type'] = $result['success'] ? 'success' : 'error';////            header('Location: dashboard.php');//            exit();        case 'delete_user':            $result = $userManager->deleteUser($_POST['user_id']);            echo json_encode([                    'success' => $result['success'],                    'message' => $result['success'] ? 'User deleted successfully!' : $result['message']            ]);//            $_SESSION['message'] = $result['success'] ? 'User deleted successfully!' : $result['message'];////            $_SESSION['message_type'] = $result['success'] ? 'success' : 'error';////            header('Location: dashboard.php');//            exit();        case 'delete_lead':            $result = $leadManager->deleteLead($_POST['lead_id']);            echo json_encode([                    'success' => $result['success'],                'message' => $result['success'] ? 'Lead deleted successfully!' : $result['message']            ]);//            $_SESSION['message'] = $result['success'] ? 'Lead deleted successfully!' : $result['message'];////            $_SESSION['message_type'] = $result['success'] ? 'success' : 'error';////            header('Location: dashboard.php');//            exit();        case 'assign_lead':            $result = $leadManager->assignLead($_POST['lead_id'], $_POST['employee_id'], $currentUser['id']);            echo json_encode([                    'success' => $result['success'],                    'message' => $result['success'] ? 'Lead Assigned successfully!' : $result['message']            ]);//            $_SESSION['message'] = $result['success'] ? 'Lead assigned successfully!' : $result['message'];////            $_SESSION['message_type'] = $result['success'] ? 'success' : 'error';////            header('Location: dashboard.php');//            exit();        case 'send_notification':            $leadId = $_POST['lead_id'];            $employeeId = $_POST['employee_id'];            $message = $_POST['message'];//            Get Employee Details to find email            $employee = $userManager->getUserById($employeeId);            $lead = $leadManager->getLeadById($leadId);            if ($employee && $lead) {                $mailResult = $mailHandler->sendEmployeeNotification(                        $employee['email'], $lead, $message);                if (is_array($mailResult)) {                    $success = !empty($mailResult['success']);                } else {                    $success = (bool)$mailResult;                }                echo json_encode([                        'success' => $success,                        'message' => $success                                ? 'Notification sent successfully!'                                : 'Failed to send email notification.'                ]);//                $_SESSION['message'] = 'Employee or Lead not found.';//                $_SESSION['message_type'] = 'error';            }            else {                echo json_encode([                        'success' => false,                        'message' => 'Employee or Lead not found.'                ]);            }//            header('Location: dashboard.php');            exit();    }}// Get data for dashboard$partners = $userManager->getPartners();$employees = $userManager->getEmployees();$allLeads = $leadManager->getAllLeads();$leadStats = $leadManager->getLeadStats();// Calculate stats$totalPartners = count($partners);$totalEmployees = count($employees);$totalLeads = count($allLeads);$newLeads = count(array_filter($allLeads, function($lead) { return $lead['status'] === 'new'; }));?><!DOCTYPE html><html lang="en"><head>    <meta charset="UTF-8">    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>Super Admin Dashboard - Fincrade</title>    <script src="https://cdn.tailwindcss.com"></script>    <script>        tailwind.config = {            theme: {                extend: {                    colors: {                        primary: {                            DEFAULT: '#0f766e',                            50: '#ecfdf5',                            100: '#d1fae5',                            200: '#a7f3d0',                            300: '#6ee7b7',                            400: '#34d399',                            500: '#10b981',                            600: '#0f766e',                            700: '#115e59',                            800: '#134e4a',                            900: '#042f2e'                        }                    }                }            }        }    </script></head><body class="bg-gray-50">    <!-- Navigation -->    <nav class="bg-white shadow-sm border-b">        <div class="max-w-7xl mx-auto px-4">            <div class="flex justify-between items-center h-16">                <div class="flex items-center">                    <h1 class="text-xl font-bold text-primary-600">Fincrade Admin</h1>                    <span class="ml-4 px-2 py-1 bg-red-100 text-red-800 text-xs font-medium rounded">Super Admin</span>                </div>                <div class="flex items-center space-x-4">                    <span class="text-gray-700">Welcome, <?php echo htmlspecialchars($currentUser['full_name']); ?></span>                    <a href="change-password.php" class="text-primary-600 hover:text-primary-700">Change Password</a>                    <a href="logout.php" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700">Logout</a>                </div>            </div>        </div>    </nav>    <div class="max-w-7xl mx-auto px-4 py-8">        <?php if (isset($_SESSION['message'])): ?>            <div class="mb-6 p-4 rounded-lg <?php echo $_SESSION['message_type'] === 'success' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'; ?>">                <?php echo htmlspecialchars($_SESSION['message']); ?>            </div>            <?php            // Clear the message after displaying            unset($_SESSION['message']);            unset($_SESSION['message_type']);            ?>        <?php endif; ?>        <!-- Stats Grid -->        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">            <div class="bg-white p-6 rounded-lg shadow">                <h3 class="text-sm font-medium text-gray-500">Total Partners</h3>                <p class="text-3xl font-bold text-primary-600"><?php echo $totalPartners; ?></p>            </div>            <div class="bg-white p-6 rounded-lg shadow">                <h3 class="text-sm font-medium text-gray-500">Total Employees</h3>                <p class="text-3xl font-bold text-primary-600"><?php echo $totalEmployees; ?></p>            </div>            <div class="bg-white p-6 rounded-lg shadow">                <h3 class="text-sm font-medium text-gray-500">Total Leads</h3>                <p class="text-3xl font-bold text-primary-600"><?php echo $totalLeads; ?></p>            </div>            <div class="bg-white p-6 rounded-lg shadow">                <h3 class="text-sm font-medium text-gray-500">New Leads</h3>                <p class="text-3xl font-bold text-orange-600"><?php echo $newLeads; ?></p>            </div>        </div>        <!-- Tabs -->        <div class="bg-white rounded-lg shadow">            <div class="border-b border-gray-200">                <nav class="-mb-px flex space-x-8 px-6">                    <a href="#" onclick="showTab('users')" id="users-tab" class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm tab-link active">                        Users Management                    </a>                    <a href="#" onclick="showTab('leads')" id="leads-tab" class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm tab-link">                        Leads Management                    </a>                    <a href="#" onclick="showTab('partner-apps')" id="partner-apps-tab" class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm tab-link">                        Partner Applications                    </a>                </nav>            </div>            <!-- Users Management Tab -->            <div id="users-content" class="tab-content p-6">                <div class="flex justify-between items-center mb-6">                    <h2 class="text-lg font-semibold">Users Management</h2>                    <button onclick="openCreateUserModal()" class="bg-primary-600 text-white px-4 py-2 rounded-lg hover:bg-primary-700">                        Create New User                    </button>                </div>                <!-- Partners Table -->                <div class="mb-8">                    <h3 class="text-md font-medium mb-4">Partners (<?php echo count($partners); ?>)</h3>                    <div class="overflow-x-auto">                        <table class="min-w-full divide-y divide-gray-200">                            <thead class="bg-gray-50">                                <tr>                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Username</th>                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Phone</th>                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>                                </tr>                            </thead>                            <tbody class="bg-white divide-y divide-gray-200">                                <?php foreach ($partners as $partner): ?>                                    <tr>                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"><?php echo htmlspecialchars($partner['full_name']); ?></td>                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"><?php echo htmlspecialchars($partner['username']); ?></td>                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"><?php echo htmlspecialchars($partner['email']); ?></td>                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"><?php echo htmlspecialchars($partner['phone']); ?></td>                                        <td class="px-6 py-4 whitespace-nowrap">                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full <?php echo $partner['status'] === 'active' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'; ?>">                                                <?php echo $partner['status']; ?>                                            </span>                                        </td>                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">                                            <button onclick="editUser(<?php echo htmlspecialchars(json_encode($partner)); ?>)" class="text-indigo-600 hover:text-indigo-900 mr-3">Edit</button>                                            <button onclick="deleteUser(<?php echo $partner['id']; ?>)" class="text-red-600 hover:text-red-900">Delete</button>                                        </td>                                    </tr>                                <?php endforeach; ?>                            </tbody>                        </table>                    </div>                </div>                <!-- Employees Table -->                <div>                    <h3 class="text-md font-medium mb-4">Employees (<?php echo count($employees); ?>)</h3>                    <div class="overflow-x-auto">                        <table class="min-w-full divide-y divide-gray-200">                            <thead class="bg-gray-50">                                <tr>                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Username</th>                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Phone</th>                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>                                </tr>                            </thead>                            <tbody class="bg-white divide-y divide-gray-200">                                <?php foreach ($employees as $employee): ?>                                    <tr>                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"><?php echo htmlspecialchars($employee['full_name']); ?></td>                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"><?php echo htmlspecialchars($employee['username']); ?></td>                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"><?php echo htmlspecialchars($employee['email']); ?></td>                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"><?php echo htmlspecialchars($employee['phone']); ?></td>                                        <td class="px-6 py-4 whitespace-nowrap">                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full <?php echo $employee['status'] === 'active' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'; ?>">                                                <?php echo $employee['status']; ?>                                            </span>                                        </td>                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">                                            <button onclick="editUser(<?php echo htmlspecialchars(json_encode($employee)); ?>)" class="text-indigo-600 hover:text-indigo-900 mr-3">Edit</button>                                            <button onclick="deleteUser(<?php echo $employee['id']; ?>)" class="text-red-600 hover:text-red-900">Delete</button>                                        </td>                                    </tr>                                <?php endforeach; ?>                            </tbody>                        </table>                    </div>                </div>            </div>            <!-- Leads Management Tab -->            <div id="leads-content" class="tab-content p-6 hidden">                <h2 class="text-lg font-semibold mb-6">Leads Management</h2>                <div class="overflow-x-auto">                    <table class="min-w-full divide-y divide-gray-200">                        <thead class="bg-gray-50">                            <tr>                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Product</th>                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Phone</th>                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Partner</th>                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Employee</th>                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Created</th>                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>                            </tr>                        </thead>                        <tbody class="bg-white divide-y divide-gray-200">                            <?php foreach ($allLeads as $lead): ?>                                <tr>                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"><?php echo htmlspecialchars($lead['name']); ?></td>                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"><?php echo htmlspecialchars($lead['product']); ?></td>                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"><?php echo htmlspecialchars($lead['phone']); ?></td>                                    <td class="px-6 py-4 whitespace-nowrap">                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full                                            <?php                                            switch($lead['status']) {                                                case 'new': echo 'bg-blue-100 text-blue-800'; break;                                                case 'assigned': echo 'bg-yellow-100 text-yellow-800'; break;                                                case 'in_progress': echo 'bg-purple-100 text-purple-800'; break;                                                case 'completed': echo 'bg-green-100 text-green-800'; break;                                                case 'rejected': echo 'bg-red-100 text-red-800'; break;                                            }                                            ?>">                                            <?php echo ucfirst(str_replace('_', ' ', $lead['status'])); ?>                                        </span>                                    </td>                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"><?php echo htmlspecialchars($lead['partner_name'] ?? 'N/A'); ?></td>                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"><?php echo htmlspecialchars($lead['employee_name'] ?? 'N/A'); ?></td>                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"><?php echo date('M j, Y', strtotime($lead['created_at'])); ?></td>                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">                                        <div class="flex space-x-2">                                            <!-- Assign Lead Button -->                                            <button onclick="showAssignModal(<?php echo $lead['id']; ?>, '<?php echo htmlspecialchars($lead['name']); ?>')"                                                    class="inline-flex items-center px-3 py-1 border border-transparent text-xs font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">                                                Assign                                            </button>                                            <?php if (!empty($lead['employee_id'])): ?>                                                <button onclick="showNotifyModal(<?php echo $lead['id']; ?>, '<?php echo htmlspecialchars($lead['name']); ?>', <?php echo $lead['employee_id']; ?>)"                                                        class="inline-flex items-center px-3 py-1 border border-transparent text-xs font-medium rounded-md text-white bg-yellow-500 hover:bg-yellow-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500"                                                        title="Send Notification Email">                                                    Notify                                                </button>                                            <?php endif; ?>                                            <!-- Delete Lead Button -->                                            <button onclick="deleteLead(<?php echo $lead['id']; ?>, '<?php echo htmlspecialchars($lead['name']); ?>')"                                                    class="inline-flex items-center px-3 py-1 border border-transparent text-xs font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">                                                Delete                                            </button>                                        </div>                                    </td>                                </tr>                            <?php endforeach; ?>                        </tbody>                    </table>                </div>            </div>            <!-- Partner Applications Tab -->            <div id="partner-apps-content" class="tab-content p-6 hidden">                <h2 class="text-lg font-semibold mb-6">Partner Applications</h2>                <?php                // Get partner applications                $database = new Database();                $conn = $database->getConnection();                $query = "SELECT * FROM partner_applications ORDER BY created_at DESC";                $stmt = $conn->prepare($query);                $stmt->execute();                $applications = $stmt->fetchAll(PDO::FETCH_ASSOC);                ?>                <div class="overflow-x-auto">                    <table class="min-w-full divide-y divide-gray-200">                        <thead class="bg-gray-50">                            <tr>                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Phone</th>                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">City</th>                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Experience</th>                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Applied</th>                            </tr>                        </thead>                        <tbody class="bg-white divide-y divide-gray-200">                            <?php foreach ($applications as $app): ?>                                <tr>                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"><?php echo htmlspecialchars($app['name']); ?></td>                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"><?php echo htmlspecialchars($app['phone']); ?></td>                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"><?php echo htmlspecialchars($app['city']); ?></td>                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"><?php echo htmlspecialchars($app['experience']); ?></td>                                    <td class="px-6 py-4 whitespace-nowrap">                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full                                            <?php                                            switch($app['status']) {                                                case 'pending': echo 'bg-yellow-100 text-yellow-800'; break;                                                case 'approved': echo 'bg-green-100 text-green-800'; break;                                                case 'rejected': echo 'bg-red-100 text-red-800'; break;                                            }                                            ?>">                                            <?php echo ucfirst($app['status']); ?>                                        </span>                                    </td>                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"><?php echo date('M j, Y', strtotime($app['created_at'])); ?></td>                                </tr>                            <?php endforeach; ?>                        </tbody>                    </table>                </div>            </div>        </div>    </div>    <div id="notifyModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden flex items-center justify-center z-50">        <div class="bg-white rounded-lg p-6 w-full max-w-md shadow-xl">            <h3 class="text-lg font-semibold mb-4">Send Notification</h3>            <form method="POST">                <input type="hidden" name="action" value="send_notification">                <input type="hidden" name="lead_id" id="notify_lead_id">                <input type="hidden" name="employee_id" id="notify_employee_id">                <div class="mb-4">                    <p class="text-sm text-gray-600">Lead: <span id="notify_lead_name" class="font-bold"></span></p>                </div>                <div class="mb-4">                    <label class="block text-sm font-medium text-gray-700">Message</label>                    <textarea name="message" rows="3" required class="w-full mt-1 border rounded-md p-2 focus:ring-primary-500" placeholder="e.g. Please update status..."></textarea>                </div>                <div class="flex justify-end space-x-3">                    <button type="button" onclick="document.getElementById('notifyModal').classList.add('hidden')" class="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400">Cancel</button>                    <button type="submit" class="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600">Send</button>                </div>            </form>        </div>    </div>    <!-- Create User Modal -->    <div id="createUserModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden">        <div class="flex items-center justify-center min-h-screen px-4">            <div class="bg-white rounded-lg max-w-md w-full p-6">                <h3 class="text-lg font-medium mb-4">Create New User</h3>                <form method="POST">                    <input type="hidden" name="action" value="create_user">                    <div class="space-y-4">                        <div>                            <label class="block text-sm font-medium text-gray-700">Full Name</label>                            <input type="text" name="full_name" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm px-3 py-2 border">                        </div>                        <div>                            <label class="block text-sm font-medium text-gray-700">Username</label>                            <input type="text" name="username" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm px-3 py-2 border">                        </div>                        <div>                            <label class="block text-sm font-medium text-gray-700">Email</label>                            <input type="email" name="email" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm px-3 py-2 border">                        </div>                        <div>                            <label class="block text-sm font-medium text-gray-700">Phone</label>                            <input type="text" name="phone" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm px-3 py-2 border">                        </div>                        <div>                            <label class="block text-sm font-medium text-gray-700">Password</label>                            <input type="password" name="password" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm px-3 py-2 border">                        </div>                        <div>                            <label class="block text-sm font-medium text-gray-700">Role</label>                            <select name="role" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm px-3 py-2 border">                                <option value="partner">Partner</option>                                <option value="employee">Employee</option>                            </select>                        </div>                    </div>                    <div class="mt-6 flex space-x-3">                        <button type="submit" class="bg-primary-600 text-white px-4 py-2 rounded-lg hover:bg-primary-700">Create User</button>                        <button type="button" onclick="closeCreateUserModal()" class="bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400">Cancel</button>                    </div>                </form>            </div>        </div>    </div>    <!-- Edit User Modal -->    <div id="editUserModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden">        <div class="flex items-center justify-center min-h-screen px-4">            <div class="bg-white rounded-lg max-w-md w-full p-6">                <h3 class="text-lg font-medium mb-4">Edit User</h3>                <form method="POST" id="editUserForm">                    <input type="hidden" name="action" value="update_user">                    <input type="hidden" name="user_id" id="edit_user_id">                    <div class="space-y-4">                        <div>                            <label class="block text-sm font-medium text-gray-700">Full Name</label>                            <input type="text" name="full_name" id="edit_full_name" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm px-3 py-2 border">                        </div>                        <div>                            <label class="block text-sm font-medium text-gray-700">Username</label>                            <input type="text" name="username" id="edit_username" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm px-3 py-2 border">                        </div>                        <div>                            <label class="block text-sm font-medium text-gray-700">Email</label>                            <input type="email" name="email" id="edit_email" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm px-3 py-2 border">                        </div>                        <div>                            <label class="block text-sm font-medium text-gray-700">Phone</label>                            <input type="text" name="phone" id="edit_phone" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm px-3 py-2 border">                        </div>                        <div>                            <label class="block text-sm font-medium text-gray-700">Status</label>                            <select name="status" id="edit_status" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm px-3 py-2 border">                                <option value="active">Active</option>                                <option value="inactive">Inactive</option>                            </select>                        </div>                    </div>                    <div class="mt-6 flex space-x-3">                        <button type="submit" class="bg-primary-600 text-white px-4 py-2 rounded-lg hover:bg-primary-700">Update User</button>                        <button type="button" onclick="closeEditUserModal()" class="bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400">Cancel</button>                    </div>                </form>            </div>        </div>    </div>    <!-- Assign Lead Modal -->    <div id="assignLeadModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden">        <div class="flex items-center justify-center min-h-screen p-4">            <div class="bg-white rounded-lg p-6 w-full max-w-md">                <h3 class="text-lg font-semibold mb-4">Assign Lead to Employee</h3>                <form method="POST">                    <input type="hidden" name="action" value="assign_lead">                    <input type="hidden" name="lead_id" id="assign_lead_id">                    <div class="mb-4">                        <p class="text-sm text-gray-600">Assigning lead: <span id="assign_lead_name" class="font-semibold"></span></p>                    </div>                    <div class="mb-4">                        <label class="block text-sm font-medium text-gray-700">Select Employee</label>                        <select name="employee_id" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm px-3 py-2 border focus:border-primary-500 focus:ring-primary-500">                            <option value="">Choose an employee</option>                            <?php foreach ($employees as $employee): ?>                                <option value="<?php echo $employee['id']; ?>"><?php echo htmlspecialchars($employee['full_name']); ?></option>                            <?php endforeach; ?>                        </select>                    </div>                    <div class="flex space-x-3">                        <button type="submit" class="bg-primary-600 text-white px-4 py-2 rounded-lg hover:bg-primary-700">Assign Lead</button>                        <button type="button" onclick="closeAssignModal()" class="bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400">Cancel</button>                    </div>                </form>            </div>        </div>    </div>    <script>        function showTab(tabName) {            // Hide all tab contents            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));            // Remove active class from all tabs            document.querySelectorAll('.tab-link').forEach(el => {                el.classList.remove('border-primary-500', 'text-primary-600');                el.classList.add('border-transparent', 'text-gray-500');            });            // Show selected tab content            document.getElementById(tabName + '-content').classList.remove('hidden');            // Add active class to selected tab            const activeTab = document.getElementById(tabName + '-tab');            activeTab.classList.remove('border-transparent', 'text-gray-500');            activeTab.classList.add('border-primary-500', 'text-primary-600');        }        function openCreateUserModal() {            document.getElementById('createUserModal').classList.remove('hidden');        }        function closeCreateUserModal() {            document.getElementById('createUserModal').classList.add('hidden');        }        function editUser(user) {            document.getElementById('edit_user_id').value = user.id;            document.getElementById('edit_full_name').value = user.full_name;            document.getElementById('edit_username').value = user.username;            document.getElementById('edit_email').value = user.email;            document.getElementById('edit_phone').value = user.phone;            document.getElementById('edit_status').value = user.status;            document.getElementById('editUserModal').classList.remove('hidden');        }        function closeEditUserModal() {            document.getElementById('editUserModal').classList.add('hidden');        }        // function deleteUser(userId) {        //        //     if (confirm('Are you sure you want to delete this user?')) {        //        //         const form = document.createElement('form');        //        //         form.method = 'POST';        //        //         form.innerHTML = `        //        //             <input type="hidden" name="action" value="delete_user">        //        //             <input type="hidden" name="user_id" value="${userId}">        //        //         `;        //        //         document.body.appendChild(form);        //        //         form.submit();        //        //     }        //        // }        // delete Lead function        // function deleteLead(leadId, leadName) {        //        //     if (confirm(`Are you sure you want to delete the lead "${leadName}"? This action cannot be undone.`)) {        //        //         const form = document.createElement('form');        //        //         form.method = 'POST';        //        //         form.innerHTML = `        //        //             <input type="hidden" name="action" value="delete_lead">        //        //             <input type="hidden" name="lead_id" value="${leadId}">        //        //         `;        //        //         document.body.appendChild(form);        //        //         form.submit();        //        //     }        //        // }        function showAssignModal(leadId, leadName) {            document.getElementById('assign_lead_id').value = leadId;            document.getElementById('assign_lead_name').textContent = leadName;            document.getElementById('assignLeadModal').classList.remove('hidden');        }        function closeAssignModal() {            document.getElementById('assignLeadModal').classList.add('hidden');        }        // Added for email notify        // Notify Modal Logic        function openNotify(btn) {            document.getElementById('notify_lead_id').value = btn.dataset.leadId;            document.getElementById('notify_employee_id').value = btn.dataset.employeeId;            document.getElementById('notify_lead_name').innerText = btn.dataset.leadName;            document.getElementById('notifyModal').classList.remove('hidden');        }        // Corrected Notify Modal Logic        function showNotifyModal(leadId, leadName, employeeId) {            document.getElementById('notify_lead_id').value = leadId;            document.getElementById('notify_employee_id').value = employeeId;            document.getElementById('notify_lead_name').innerText = leadName;            document.getElementById('notifyModal').classList.remove('hidden');        }        function closeNotifyModal() {            document.getElementById('notifyModal').classList.add('hidden');        }        // fetch('dashboard.php' , {        //     method: "POST",        //     body: new FormData(form)        // })        //     .then(r => r.json())        //     .then(data => {        //         alert(data.message);        //     });        // ---- AJAX HANDLERS ADD ----        document.addEventListener('DOMContentLoaded', function () {            // common handler for modal forms (create, edit, assign, notify)            function ajaxFormHandler(e) {                e.preventDefault();                const form = e.target;                const formData = new FormData(form);                fetch('dashboard.php', {                    method: 'POST',                    body: formData                })                    .then(res => res.json())                    .then(data => {                        console.log('AJAX RESPONSE:', data);                        alert(data.message || 'Done');                        if (data.success) {                            // simple option: page reload (same URL, no JSON white page)                            window.location.reload();                        }                    })                    .catch(err => console.error('AJAX ERROR:',err));            }            // Create user modal form            const createUserForm = document.querySelector('#createUserModal form');            if (createUserForm) {                createUserForm.addEventListener('submit', ajaxFormHandler);            }            // Edit user modal form            const editUserForm = document.getElementById('editUserForm');            if (editUserForm) {                editUserForm.addEventListener('submit', ajaxFormHandler);            }            // Assign lead modal form            const assignLeadForm = document.querySelector('#assignLeadModal form');            if (assignLeadForm) {                assignLeadForm.addEventListener('submit', ajaxFormHandler);            }            // Notify modal form            const notifyForm = document.querySelector('#notifyModal form');            if (notifyForm) {                notifyForm.addEventListener('submit', ajaxFormHandler);            }        //     Show Tab for new settings            const savedTab = localStorage.getItem('admin_active_tab') || 'users';            showTab(savedTab);        });        // ---- delete functions ko fetch se likho ----        function deleteUser(userId) {            if (!confirm('Are you sure you want to delete this user?')) return;            const formData = new FormData();            formData.append('action', 'delete_user');            formData.append('user_id', userId);            fetch('dashboard.php', {                method: 'POST',                body: formData            })                .then(res => res.json())                .then(data => {                    console.log('DELETE USER RESPONSE:', data);                    alert(data.message || 'Done');                    if (data.success) {                        window.location.reload();                    }                })                .catch(err => console.error(err));        }        function deleteLead(leadId, leadName) {            if (!confirm(`Are you sure you want to delete the lead "${leadName}"? This action cannot be undone.`)) return;            const formData = new FormData();            formData.append('action', 'delete_lead');            formData.append('lead_id', leadId);            fetch('dashboard.php', {                method: 'POST',                body: formData            })                .then(res => res.json())                .then(data => {                    alert(data.message || 'Done');                    if (data.success) {                        window.location.reload();                    }                })                .catch(err => console.error(err));        }        // Initialize first tab        function showTab(tabName) {            // Hide all tab contents            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));            // Remove active class from all tabs            document.querySelectorAll('.tab-link').forEach(el => {                el.classList.remove('border-primary-500', 'text-primary-600');                el.classList.add('border-transparent', 'text-gray-500');            });            // Show selected tab content            document.getElementById(tabName + '-content').classList.remove('hidden');            // Add active class to selected tab            const activeTab = document.getElementById(tabName + '-tab');            activeTab.classList.remove('border-transparent', 'text-gray-500');            activeTab.classList.add('border-primary-500', 'text-primary-600');            // ðŸ”µ yahan save kar rahe hain kaunsa tab active hai            localStorage.setItem('admin_active_tab', tabName);        }        // showTab('users');    </script></body></html>